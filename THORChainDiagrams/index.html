<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.26.2 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>THORChain Diagrams and Code Flow - GrassRoots Crypto</title>
<meta name="description" content="Crypto Education">


  <meta name="author" content="Chris">
  


<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="GrassRoots Crypto">
<meta property="og:title" content="THORChain Diagrams and Code Flow">
<meta property="og:url" content="https://grassrootscrypto.io/THORChainDiagrams/">


  <meta property="og:description" content="Crypto Education">





  <meta name="twitter:site" content="@GrassRootsio">
  <meta name="twitter:title" content="THORChain Diagrams and Code Flow">
  <meta name="twitter:description" content="Crypto Education">
  <meta name="twitter:url" content="https://grassrootscrypto.io/THORChainDiagrams/">

  
    <meta name="twitter:card" content="summary">
    
  

  








<link rel="canonical" href="https://grassrootscrypto.io/THORChainDiagrams/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "GrassRoots Crypto",
      "url": "https://grassrootscrypto.io/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="GrassRoots Crypto Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--splash wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/Grassroots_Crypto_Logo.png" alt=""></a>
        
        <a class="site-title" href="/">
          GrassRoots Crypto
          <span class="site-subtitle">Teaching people about Crypto!</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/categories/">Posts</a>
            </li><li class="masthead__menu-item">
              <a href="/services/" title="What GrassRoots Crypto can do for you?">Services</a>
            </li><li class="masthead__menu-item">
              <a href="/ReferralLinks/">Referral Links</a>
            </li><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li><li class="masthead__menu-item">
              <a href="/search/">Search</a>
            </li><li class="masthead__menu-item">
              <a href="/disclaimer/" title="Disclaimer, Disclosure and Copyright!">Disclaimer</a>
            </li><li class="masthead__menu-item">
              <a href="/sitemap/">Sitemap</a>
            </li><li class="masthead__menu-item">
              <a href="/THORChainDiagrams/" title="THORChain Diagrams">Diagrams</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      

<div id="main" role="main">
  <article class="splash" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="THORChain Diagrams and Code Flow">
    
    
    

    <section class="page__content" itemprop="text">
      <p>Working pictures of THORChain. Work in progress. Please provide feedback in the Dev discord server - DevOps channel.</p>

<h2 id="high-level-app-overview">High Level App Overview</h2>

<p><img src="/assets/images/TCALHL.png" alt="High Level App View" />
These are the major components within THORChain.
THORChain extends the Cosmos BaseApp and has its own module for specific message handling and processing.</p>

<p>See my <a href="https://youtu.be/Qowrasst2UQ">Develop on THORChain - Full Guide</a> video for more detailed information.</p>

<h3 id="swap-example---inbound-and-outbound">Swap Example - Inbound and Outbound</h3>

<p>Example BTC to ETH Swap overview - High Level.</p>

<p><img src="/assets/images/THORChain Swap.png" alt="High Level App View" />
See larger PDF version <a href="/assets/documents/THORChain-Swap.pdf"> here</a></p>

<p>Key points in the diagram:</p>

<ol>
  <li>THORChain will see the BTC transaction in the Mempool. However, transactions must be confirmed and wait times are applied before processing based on the swap size (inbound liquidity). This is seen by the <code class="language-plaintext highlighter-rouge">blockscanner</code> which has access to a full BTC node running within the THORNode cluster. THORChain translates this transaction into a standard witness transaction and sent to the <code class="language-plaintext highlighter-rouge">Observer</code> service. From there they are packaged, signed and sent to THORChain for processing (via the bridge).</li>
  <li>Inbound funds are sent to the <a href="https://thornode.ninerealms.com/thorchain/inbound_addresses">Asgard Vault</a>.</li>
  <li>Virtual Machines (VMs) does not apply to THORChain, it is a blockchain application or a replicated state machine.</li>
  <li>THORChain has two levels of processing – external (TSS) and internal (Tendermint).</li>
  <li>Tendermint broadcasts messages via the Gossip protocol (same as flooding) and gets consensus on the txs, but it is up to THORChain to check everything is good, e.g. Tx Out matches Swap Tx In, BlockHeight is correct and so on.</li>
  <li>Nodes agree on the <code class="language-plaintext highlighter-rouge">out tx</code> (as per above). A TSS vault is selected to send the ETH Transaction.</li>
  <li>Asgard/TSS is used for outbound txs. 2/3 of TSS Key Gen set is required to sign the outgoing ETH Tx.</li>
  <li>Bifrost can only send messages that it gets from the THORChain bridge, so indirectly when the Asgard Vault sends an ETH transaction, it already has 2/3 consensus.</li>
  <li>Transaction goes to ETH’s mempool as normal.</li>
  <li>Once the funds leave THORChain, it creates an <code class="language-plaintext highlighter-rouge">OutboundTx</code> which is then observed by THORChain (Bifrost). This ensures that what was sent is what was meant to be sent.</li>
</ol>

<p>Memos types like <code class="language-plaintext highlighter-rouge">swap</code> will create an outbound message, others like <code class="language-plaintext highlighter-rouge">add</code> or <code class="language-plaintext highlighter-rouge">RUNEPool+</code> do not. See <a href="https://dev.thorchain.org/concepts/memos.html">Transaction Memos</a> for a full list of memos.</p>

<h3 id="swap-example---msg-flow">Swap Example - Msg Flow</h3>

<p>Another look at the same swap as above but looking the message flow.
<img src="/assets/images/THORChain Swap Msg.png" alt="High Level App View" /></p>

<h3 id="swap-example-detailed-code-flow">Swap Example Detailed Code Flow</h3>

<p>This diagram follows the inbound process only. There would be a separate flow for the outbound <code class="language-plaintext highlighter-rouge">MsgOutboundTx</code> once the ETH is sent.
<img src="/assets/images/THORChain-Swap-CodeFlow.jpg" alt="Swap Code Flow" />
See larger PDF version <a href="/assets/documents/THORChain-Swap.pdf"> here</a></p>

<h2 id="high-level-add-liquidity-example">High Level Add Liquidity Example</h2>

<p><img src="/assets/images/TC-AddLiq-Flow.png" alt="High Level App View" /></p>

<h2 id="add-liquidity--example-detailed-code-flow">Add Liquidity  Example Detailed Code Flow</h2>

<p><img src="/assets/images/TC-AddLiq-Msg-Flow.png" alt="High Level App View" /></p>

<p>In this example, there is no outbound message.</p>

<h3 id="add-liquidity-example-code-flow">Add Liquidity Example Code Flow</h3>

<p>See larger PDF version <a href="/assets/documents/THORChain-Add.pdf"> here</a></p>

<hr />

<h3 id="write-up-by-hildisvínióttar-on-msgsend-and-msgdeposit">Write up by HildisvíniÓttar on MsgSend and MsgDeposit</h3>

<p>In handler.go there are various ways of receiving incoming. You basically have Bifrost observations that require 2/3 consensus, cli node functions (require auth), and the two generic ones (i.e. supported by Ledger): ~<code class="language-plaintext highlighter-rouge">MsgSend</code> and <code class="language-plaintext highlighter-rouge">MsgDeposit</code></p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// Consensus handlers - can only be sent by addresses in</span>
<span class="c">//   the active validator set.</span>
<span class="n">m</span><span class="p">[</span><span class="n">MsgTssPool</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewTssHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
<span class="n">m</span><span class="p">[</span><span class="n">MsgObservedTxIn</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewObservedTxInHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
<span class="n">m</span><span class="p">[</span><span class="n">MsgObservedTxOut</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewObservedTxOutHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
<span class="n">m</span><span class="p">[</span><span class="n">MsgTssKeysignFail</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewTssKeysignHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
<span class="n">m</span><span class="p">[</span><span class="n">MsgErrataTx</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewErrataTxHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
<span class="n">m</span><span class="p">[</span><span class="n">MsgBan</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewBanHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
<span class="n">m</span><span class="p">[</span><span class="n">MsgNetworkFee</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewNetworkFeeHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
<span class="n">m</span><span class="p">[</span><span class="n">MsgSolvency</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewSolvencyHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>

<span class="c">// cli handlers (non-consensus)</span>
<span class="n">m</span><span class="p">[</span><span class="n">MsgMimir</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewMimirHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
<span class="n">m</span><span class="p">[</span><span class="n">MsgSetNodeKeys</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewSetNodeKeysHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
<span class="n">m</span><span class="p">[</span><span class="n">MsgSetVersion</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewVersionHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
<span class="n">m</span><span class="p">[</span><span class="n">MsgSetIPAddress</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewIPAddressHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
<span class="n">m</span><span class="p">[</span><span class="n">MsgNodePauseChain</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewNodePauseChainHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>

<span class="c">// native handlers (non-consensus)</span>
<span class="n">m</span><span class="p">[</span><span class="n">MsgSend</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewSendHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
<span class="n">m</span><span class="p">[</span><span class="n">MsgDeposit</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewDepositHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
</code></pre></div></div>

<p>External Message Mapping for the THORChain Module. These are received and routed by the <code class="language-plaintext highlighter-rouge">ExternalHandler</code>.</p>

<p>Anybody can post a MsgSend or MsgDeposit to the /txs endpoint - see <code class="language-plaintext highlighter-rouge">x\thorchain\client\rest</code>. It’s just some JSON. Cosmos does require you have a valid signature for one of the fields, e.g. from_address or signer. This ensures you are authorised to perform the function.</p>

<h3 id="deposit-msg">Deposit Msg</h3>

<p>Note: Deposit Msg is when Rune gets sent in, e.g. Bond - it does not come via Bifrost.</p>

<p>At its heart, THORChain is a key-value database containing everybody’s balances, plus a bunch of other stuff. It starts at genesis state, and processes every Msg sent to it in order, and mutates the state. Until you get to the current state. Cosmos/Tendermint handles the underlying message stuff. Thornode is the bit that reads these messages and mutates its database to keep track of everything.</p>

<p>In MsgSend handler, it just checks the KV database to ensure you have enough balance for what you asked to send, subtracts fee and sends balance to whomever you specified. Done. At the beginning it stops early if “HaltTHORChain” is enabled. Which is currently set.</p>

<p>In MsgDeposit handler (handler_deposit.go) it’s a little more complex. It deducts the coins you sent in with MsgDeposit from your balance, then reads the MEMO you sent, works out what kind of “internal” message (function) you are trying to perform, and executes one of the internal handlers, such as Bond, Unbond, LEAVE, …..</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="n">m</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="n">MsgHandler</span><span class="p">)</span>
	<span class="n">m</span><span class="p">[</span><span class="n">MsgOutboundTx</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewOutboundTxHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
	<span class="n">m</span><span class="p">[</span><span class="n">MsgSwap</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewSwapHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
	<span class="n">m</span><span class="p">[</span><span class="n">MsgReserveContributor</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewReserveContributorHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
	<span class="n">m</span><span class="p">[</span><span class="n">MsgBond</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewBondHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
	<span class="n">m</span><span class="p">[</span><span class="n">MsgUnBond</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewUnBondHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
	<span class="n">m</span><span class="p">[</span><span class="n">MsgLeave</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewLeaveHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
	<span class="n">m</span><span class="p">[</span><span class="n">MsgDonate</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewDonateHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
	<span class="n">m</span><span class="p">[</span><span class="n">MsgWithdrawLiquidity</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewWithdrawLiquidityHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
	<span class="n">m</span><span class="p">[</span><span class="n">MsgAddLiquidity</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewAddLiquidityHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
	<span class="n">m</span><span class="p">[</span><span class="n">MsgRefundTx</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewRefundHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
	<span class="n">m</span><span class="p">[</span><span class="n">MsgMigrate</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewMigrateHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
	<span class="n">m</span><span class="p">[</span><span class="n">MsgRagnarok</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewRagnarokHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
	<span class="n">m</span><span class="p">[</span><span class="n">MsgNoOp</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewNoOpHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
	<span class="n">m</span><span class="p">[</span><span class="n">MsgConsolidate</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewConsolidateHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
	<span class="n">m</span><span class="p">[</span><span class="n">MsgManageTHORName</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewManageTHORNameHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
	<span class="n">m</span><span class="p">[</span><span class="n">MsgLoanOpen</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewLoanOpenHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
	<span class="n">m</span><span class="p">[</span><span class="n">MsgLoanRepayment</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewLoanRepaymentHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
	<span class="n">m</span><span class="p">[</span><span class="n">MsgTradeAccountDeposit</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewTradeAccountDepositHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
	<span class="n">m</span><span class="p">[</span><span class="n">MsgTradeAccountWithdrawal</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewTradeAccountWithdrawalHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
	<span class="n">m</span><span class="p">[</span><span class="n">MsgRunePoolDeposit</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewRunePoolDepositHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
	<span class="n">m</span><span class="p">[</span><span class="n">MsgRunePoolWithdraw</span><span class="p">{}</span><span class="o">.</span><span class="n">Type</span><span class="p">()]</span> <span class="o">=</span> <span class="n">NewRunePoolWithdrawHandler</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
</code></pre></div></div>

<p>Internal Message Mapping. This is handled by <code class="language-plaintext highlighter-rouge">InternalHandler</code></p>

<p>Some of these are disabled by MsgDeposit handler, so you only have a finite list of things you can do. These are the things being audited now.
So that’s thornode. Basically send it a MsgSend or MsgDeposit and it authorises you via digital signature and reads your memo and tries to perform the function. Plus you can send it Set IP Address, Node Keys and Version via CLI tools (but these require signer to be an active node, etc).</p>

<h3 id="bifrost">Bifrost</h3>

<p>The other side of THORChain is “Bifrost”. This is where a user use an external chain to interact with THORChain</p>

<p>This is a process that reads every block (and sometimes mempool) from all the supported chains: BTC, ETH, BCH, LTC, GIA, AVAX, BSC and DOGE. Call it a block scanner. It also has the ability to sign transactions out.</p>

<p>For observations, Bifrost will “see” a transaction inbound to one of its monitored addresses. Say you send some BTC to the BTC vault with memo <code class="language-plaintext highlighter-rouge">"BTC/BTC+"</code> (savers addition). Bifrost reads this and goes “Yep that’s legit” and sends a <code class="language-plaintext highlighter-rouge">MsgObservedTxIn</code> to Thornode. This gets passed to the observed_txin handler. The first thing it does is “vote” on this transaction being legit. If you are the first bifrost to “see” this, nothing happens - you actually get slashed. Then the next 1-2 seconds as all the other Bifrost also “see” this tx in, and send <code class="language-plaintext highlighter-rouge">MsgObservedTxIn</code> to their thornodes, the “vote count” increases, until 2/3 of active nodes have seen this tx, and it’s considered legit. You get your slash removed, and your tx in handler processes the rest of the transaction.</p>

<h3 id="message-types">Message Types</h3>

<p>The following code snippets show how different transaction types are classified.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="p">(</span><span class="n">tx</span> <span class="n">TxType</span><span class="p">)</span> <span class="n">IsInbound</span><span class="p">()</span> <span class="kt">bool</span> <span class="p">{</span>
	<span class="k">switch</span> <span class="n">tx</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">TxAdd</span><span class="p">,</span> <span class="n">TxWithdraw</span><span class="p">,</span> <span class="n">TxTradeAccountDeposit</span><span class="p">,</span> <span class="n">TxRunePoolDeposit</span><span class="p">,</span> <span class="n">TxRunePoolWithdraw</span><span class="p">,</span> <span class="n">TxSwap</span><span class="p">,</span> <span class="n">TxLimitOrder</span><span class="p">,</span> <span class="n">TxDonate</span><span class="p">,</span> <span class="n">TxBond</span><span class="p">,</span> <span class="n">TxUnbond</span><span class="p">,</span> <span class="n">TxLeave</span><span class="p">,</span> <span class="n">TxReserve</span><span class="p">,</span> <span class="n">TxNoOp</span><span class="p">,</span> <span class="n">TxTHORName</span><span class="p">,</span> <span class="n">TxLoanOpen</span><span class="p">,</span> <span class="n">TxLoanRepayment</span><span class="o">:</span>
		<span class="k">return</span> <span class="no">true</span>
	<span class="k">default</span><span class="o">:</span>
		<span class="k">return</span> <span class="no">false</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">tx</span> <span class="n">TxType</span><span class="p">)</span> <span class="n">IsOutbound</span><span class="p">()</span> <span class="kt">bool</span> <span class="p">{</span>
	<span class="k">switch</span> <span class="n">tx</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">TxOutbound</span><span class="p">,</span> <span class="n">TxRefund</span><span class="p">,</span> <span class="n">TxRagnarok</span><span class="o">:</span>
		<span class="k">return</span> <span class="no">true</span>
	<span class="k">default</span><span class="o">:</span>
		<span class="k">return</span> <span class="no">false</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">tx</span> <span class="n">TxType</span><span class="p">)</span> <span class="n">IsInternal</span><span class="p">()</span> <span class="kt">bool</span> <span class="p">{</span>
	<span class="k">switch</span> <span class="n">tx</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">TxMigrate</span><span class="p">,</span> <span class="n">TxConsolidate</span><span class="o">:</span>
		<span class="k">return</span> <span class="no">true</span>
	<span class="k">default</span><span class="o">:</span>
		<span class="k">return</span> <span class="no">false</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

    </section>
  </article>
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/GrassRootsio" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
      
        
      
        
          <li><a href="https://t.me/GrassRootsCrypto" rel="nofollow noopener noreferrer"><i class="fab fa-telegram-plane" aria-hidden="true"></i> Telegram</a></li>
        
      
        
          <li><a href="https://www.youtube.com/c/grassrootscrypto" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-youtube" aria-hidden="true"></i> Youtube</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 GrassRoots Crypto. <a href="/disclaimer/" rel="nofollow">Copyright. All Rights Reserved</a> </div>


      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NH9NNXEF3M"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NH9NNXEF3M', { 'anonymize_ip': false});
</script>









  </body>
</html>
