<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.26.2 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>THORChain Impermanent Loss Protection - GrassRoots Crypto</title>
<meta name="description" content="THORChain has implemented Impermanent Loss Protection in MCCN. If youâ€™re not sure about Impermanent Loss, see here first. Once you have seen the video, you can read below for a more detailed explanation and learning.">


  <meta name="author" content="Chris">
  
  <meta property="article:author" content="Chris">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="GrassRoots Crypto">
<meta property="og:title" content="THORChain Impermanent Loss Protection">
<meta property="og:url" content="https://grassrootscrypto.io/defi/thorchain/IL-Protection/">


  <meta property="og:description" content="THORChain has implemented Impermanent Loss Protection in MCCN. If youâ€™re not sure about Impermanent Loss, see here first. Once you have seen the video, you can read below for a more detailed explanation and learning.">





  <meta name="twitter:site" content="@GrassRootsio">
  <meta name="twitter:title" content="THORChain Impermanent Loss Protection">
  <meta name="twitter:description" content="THORChain has implemented Impermanent Loss Protection in MCCN. If youâ€™re not sure about Impermanent Loss, see here first. Once you have seen the video, you can read below for a more detailed explanation and learning.">
  <meta name="twitter:url" content="https://grassrootscrypto.io/defi/thorchain/IL-Protection/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2021-04-29T00:00:00+09:30">






<link rel="canonical" href="https://grassrootscrypto.io/defi/thorchain/IL-Protection/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "GrassRoots Crypto",
      "url": "https://grassrootscrypto.io/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="GrassRoots Crypto Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/Grassroots_Crypto_Logo.png" alt=""></a>
        
        <a class="site-title" href="/">
          GrassRoots Crypto
          <span class="site-subtitle">Teaching people about Crypto!</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/categories/">Posts</a>
            </li><li class="masthead__menu-item">
              <a href="/services/" title="What GrassRoots Crypto can do for you?">Services</a>
            </li><li class="masthead__menu-item">
              <a href="/ReferralLinks/">Referral Links</a>
            </li><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li><li class="masthead__menu-item">
              <a href="/search/">Search</a>
            </li><li class="masthead__menu-item">
              <a href="/disclaimer/" title="Disclaimer, Disclosure and Copyright!">Disclaimer</a>
            </li><li class="masthead__menu-item">
              <a href="/sitemap/">Sitemap</a>
            </li><li class="masthead__menu-item">
              <a href="/THORChainDiagrams/" title="THORChain Diagrams">Diagrams</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="THORChain Impermanent Loss Protection">
    <meta itemprop="description" content="THORChain has implemented Impermanent Loss Protection in MCCN. If youâ€™re not sure about Impermanent Loss, see here first.Once you have seen the video, you can read below for a more detailed explanation and learning.">
    <meta itemprop="datePublished" content="2021-04-29T00:00:00+09:30">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">THORChain Impermanent Loss Protection
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          6 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>THORChain has implemented Impermanent Loss Protection in MCCN. If youâ€™re not sure about Impermanent Loss, <a href="/defi/impermanent-loss-explained/">see here first.</a>
Once you have seen the video, you can read below for a more detailed explanation and learning.</p>

<h3 id="impermanent-loss-protection-explained">Impermanent Loss Protection Explained</h3>

<!-- Courtesy of embedresponsively.com //-->

<div class="responsive-video-container">
    <iframe src="https://www.youtube-nocookie.com/embed/yce7OJ_z57g" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe>
  </div>

<h3 id="additional-notes---how-it-is-really-asset-based-not-priced-based">Additional Notes - How it is really asset based, not priced based.</h3>

<p>THORChain does not care about the price at all. To get a price, it looks at the ratio of Rune to, say, BUSD to get the price of Rune, and then looks at the ratio of RUNE / BTC to get the price of BTC. This assumes that the pool is balanced.
When you deposit, the amount of assets is recorded, remembering that all deposits (and withdrawals) are calculated symmetrically. If BTC doubles and RUNE stays flat, then the ratio will change to have less BTC and more RUNE. But funds are lost during the rebalancing process (by Arbing), so the amount of assets will be less than if you were just holding, even if the ratio is the same.
When you withdraw, THORChain looks at what you deposited and what you are withdrawing and then compares the asset difference on each side to what you â€˜shouldâ€™ have if you were holding. It will pay out the difference.
Note: the withdrawn assets include fees/revenue earned as an LP, hence the net difference, so the difference may be 0.
THORChain works out from the asset amounts only. It can put a price on it as described above. This is what is done in the coverage section of the spec. This is combined with the protection part to find the % of payment you are entitled to (1-100%).</p>

<h3 id="more-detailed-information-about-impermanent-loss">More Detailed information about Impermanent Loss</h3>

<p>I have previously explained that Impermanent Loss is caused due to the rebalancing process, e.g., arbs taking funds from the pool. While at the basic level, it is a good way to think about it, it is not really true. Like with most things in Crypto, the deeper you go, the more complex it becomes and the more high-level explanations become false.</p>

<p>To be specific, Impermanent Loss is strictly caused by a change in the price of one or more assets in the pool. This will change the ratio of asset to rune in the pool, which will change the pool price. So one side will be selling at a discount, and the other will be at a premium. This then incentivizes arbs to take advantage of the price difference, as explained in my Liquidity Pooling video, which will then bring the pool back into balance. It is the change of the Pool price (due to the change of price) that causes IL, not the arb process.
There are a number of distinct steps here; letâ€™s use a BTC/RUNE pool here, but the process is the same for any pool with 2 assets in an AMM.</p>

<ol>
  <li>The price of an asset in the pool changes.</li>
  <li>The ratio of BTC to Rune Pool changes in response to the price change.</li>
  <li>Due to the ratio change, the price of BTC and RUNE is changed (either up or down, depending on the price movement). At this point, Impermanent Loss has occurred.</li>
  <li>Now an opportunity is presented to arbs â€“ however, they are not forced to take it.</li>
</ol>

<p>Hope that helps!</p>

<h3 id="extra-details-from-a-write-up-in-thorchain-dev-discord-added-22nd-nov-21">Extra details from a write-up in THORChain Dev Discord. (Added 22nd Nov 21)</h3>

<p>Below is as of version 0.75 of the code.</p>

<p>ILP is calculated within the withdraw_handler and does not care at all how liquidity has been added or how it is going to be withdrawn. ILP is calculated in RUNE (like everything else in THORChain), making it impartial to all/any assets. Only the ratio of the pool at the time of the withdraw is important.
Let me lay it out.</p>

<p>The line <a href="https://gitlab.com/thorchain/thornode/-/blob/develop/x/thorchain/withdraw_current.go#L83"><code class="language-plaintext highlighter-rouge">if fullProtectionLine &gt; 0 &amp;&amp; pool.Status == PoolAvailable</code></a> checks if ILP is active (protection line is taken from the constants (<code class="language-plaintext highlighter-rouge">FullImpLossProtectionBlocks</code>)) and if the pool is active. 
ILP is calculated within <a href="https://gitlab.com/thorchain/thornode/-/blob/develop/x/thorchain/withdraw_current.go#L222"><code class="language-plaintext highlighter-rouge">calcImpLossV75</code></a> and uses the formula <code class="language-plaintext highlighter-rouge">coverage = ((A0 * P1) + R0) - ((A1 * P1) + R1)</code> â€“ this puts all the values into rune. The calculation is then as simple as: rune value when deposited take rune value when withdrawing. If the result is &gt; 0, there is going to be a payout.</p>

<p><code class="language-plaintext highlighter-rouge">protectionBasisPoints</code> (calculated previously form <code class="language-plaintext highlighter-rouge">protectionBasisPoints := calcImpLossProtectionAmtV1(ctx, lastAddHeight, fullProtectionLine</code>) is used to work out the <a href="https://gitlab.com/thorchain/thornode/-/blob/develop/x/thorchain/withdraw_current.go#L243"><code class="language-plaintext highlighter-rouge">coverage</code></a> e.g. how many days the LPer has been in the pool. 100 days or more equals 100%.</p>

<p>If there is going to be an ILP payout, THORChain  <a href="https://gitlab.com/thorchain/thornode/-/blob/develop/x/thorchain/withdraw_current.go#L100">adds</a> the liquidity (the rune value of the ILP) to the LPer BEFORE the actual withdraw is done - thus their position (Liquidity Units) are updated before withdraw.</p>

<p><b>Note:</b> Liquidity Units are denoted in RUNE (like everything is) so by incrementing someoneâ€™s liquidity units (e.g., RUNE) you are, by consequence, adding the corresponding asset value to the LPer, taking into consideration the ratio of the pool at the time. Thus, in general (at least at deposit and in this context), an LPerâ€™s Liquidity Units are going to be the Rune side of the pool. Again, making THORChain processing impartial to all assets. That is how I understand it anyway ðŸ˜Š See <a href="https://docs.thorchain.org/thorchain-finance/continuous-liquidity-pools#calculating-pool-ownership"><code class="language-plaintext highlighter-rouge">calculating-pool-ownership</code> in the docs</a> for the exact details.</p>

<p>After the ILP Payout is calculated, how the withdrawal is going to be done, e.g., Asym or Sym (done in <code class="language-plaintext highlighter-rouge">calculateWithdrawV75</code>) and the gas requirements for the withdrawal are calculated. The actual withdrawal of liquidity is then done.</p>

<p>Given this, it is clear that ILP is irrespective of how liquidity is added, removed, or even what asset is in question. Also, if there is a payout, an LPerâ€™s position is updated before the withdraw process is done. I created this video going through a detailed example following the same process if anyone wants to know more or see a working example. https://www.youtube.com/watch?v=C8cYaugKSFw
YouTube.</p>

<h3 id="what-happens-if-you-withdraw-part-of-your-liquidity">What happens if you withdraw part of your liquidity?</h3>

<p><code class="language-plaintext highlighter-rouge">withdrawBasisPoints</code> is used to work out how much you are withdrawing, everything is actually calculated form that.</p>

<p><code class="language-plaintext highlighter-rouge">
    // taking withdrawBasisPoints, calculate how much of the coverage the user should receives
    coverage = common.GetSafeShare(withdrawBasisPoints, cosmos.NewUint(10000), coverage)
</code></p>

<p>Thus, given the following situation</p>
<ol>
  <li>1 April - Deposit RUNE+ETH @ 200:1</li>
  <li>1 Aug - Withdraw 50% of LP @ 300:1 (ILP given)</li>
  <li>1 Sep - Withdraw balance @ 400:1</li>
</ol>

<p><strong>Q:</strong> Will the protocol will give ILP based on 400:1 vs 200:1 and not 400:1 vs 300:1 right?</p>

<p><strong>A:</strong> You will get the ratio at the time you withdraw. So 2 and 3 apply. This is done so it is a proper comparison against holding - at the time of withdraw.</p>

<p>Last note for the pedantic. V75 did update the ILP calculation to <code class="language-plaintext highlighter-rouge">coverage = ((A0 * P1) + R0) - ((A1 * P1) + R1) =&gt; ((A0 * R1/A1) + R0) - (R1 + R1)</code>. (https://gitlab.com/thorchain/thornode/-/merge_requests/1993)</p>

<p>This works out the same as <code class="language-plaintext highlighter-rouge">coverage = ((A0 * P1) + R0) - ((A1 * P1) + R1)</code>. V75 is just adding an additional check to see if <code class="language-plaintext highlighter-rouge">R1*2</code> is greater than to or equal to <code class="language-plaintext highlighter-rouge">((A1 * P1) + R1)</code>, as <code class="language-plaintext highlighter-rouge">(A1 * P1)</code> the asset value into RUNE at the time of withdraw.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#cross-chain-swaps" class="page__taxonomy-item" rel="tag">Cross Chain Swaps</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#impermanent-loss" class="page__taxonomy-item" rel="tag">Impermanent Loss</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#liquidity-pool" class="page__taxonomy-item" rel="tag">Liquidity Pool</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#liquidity-provider" class="page__taxonomy-item" rel="tag">Liquidity Provider</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#mccn" class="page__taxonomy-item" rel="tag">MCCN</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#defi" class="page__taxonomy-item" rel="tag">DeFi</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#thorchain" class="page__taxonomy-item" rel="tag">THORChain</a>
    
    </span>
  </p>


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2021-04-29T00:00:00+09:30">April 29, 2021</time></p>


      </footer>

      

      
  <nav class="pagination">
    
      <a href="/defi/thorchain/new-to-thorchain/" class="pagination--pager" title="Beginnerâ€™s Guide to THORChain
">Previous</a>
    
    
      <a href="/defi/thorchain/List-THORChain-Videos/" class="pagination--pager" title="THORChain Videos
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <section id="static-comments">
        
      </section>
    
</div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/thorchain/February-Update/" rel="permalink">THORChain February Update
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          7 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">I wanted create a post about THORChain as a lot has happened this year. The biggest update is regarding THORFi and there is a lot to unpack, so I will leave ...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/thorchain/rujira/thorchain-rujitrade/" rel="permalink">THORChain + Ruji Trade
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          less than 1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">I made a video regarding Ruji Trade and how it is going to work. Also see below an updated version of the picture used.

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/thorchain/thorchain-cosmos/" rel="permalink">THORChain + Cosmos Update
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          7 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">A lot is happening with THORChain, so Iâ€™ve been doing research to understand it better. I wanted to dive deeper into COSMWASM, IBC, and the upcoming Kujira p...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/beginner/smsf-bitcoin/" rel="permalink">Bitcoin in SMSF
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">I have done some write-up for friends interested in having Bitcoin in their SMSF so I have cleaned it up a bit and shared it on my website.

</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/GrassRootsio" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
      
        
      
        
          <li><a href="https://t.me/GrassRootsCrypto" rel="nofollow noopener noreferrer"><i class="fab fa-telegram-plane" aria-hidden="true"></i> Telegram</a></li>
        
      
        
          <li><a href="https://www.youtube.com/c/grassrootscrypto" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-youtube" aria-hidden="true"></i> Youtube</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 GrassRoots Crypto. <a href="/disclaimer/" rel="nofollow">Copyright. All Rights Reserved</a> </div>


      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NH9NNXEF3M"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NH9NNXEF3M', { 'anonymize_ip': false});
</script>






    

  





  </body>
</html>
